CONFIG_KERNEL_BIN_NAME="madi"

# POSIX API (sleep_ms, pthread compatibility)
# CONFIG_POSIX_API=y already selects POSIX_TIMERS and POSIX_THREADS
# via POSIX_AEP_REALTIME_MINIMAL — no need for deprecated wrappers
CONFIG_POSIX_API=y
CONFIG_XSI_SINGLE_PROCESS=y

# C library
CONFIG_NEWLIB_LIBC=y
CONFIG_NEWLIB_LIBC_NANO=y

# GPIO
CONFIG_GPIO=y

# RTT console (replaces UART)
CONFIG_USE_SEGGER_RTT=y
CONFIG_RTT_CONSOLE=y
CONFIG_CONSOLE=y
CONFIG_STDOUT_CONSOLE=y
CONFIG_PRINTK=y

# Logging via RTT
CONFIG_LOG=y
CONFIG_LOG_MODE_IMMEDIATE=y
CONFIG_LOG_BACKEND_RTT=y
CONFIG_LOG_BACKEND_UART=n

# Hardware info (serial number, reset cause)
CONFIG_HWINFO=y

# Stack sizes
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096

# USB device stack thread sizes — defaults (1024/512) overflow during CDC ACM
# enumeration on nRF52840.
CONFIG_USBD_THREAD_STACK_SIZE=2048
CONFIG_UDC_NRF_THREAD_STACK_SIZE=2048

# Heap
CONFIG_HEAP_MEM_POOL_SIZE=8192

# Assertions
CONFIG_ASSERT=y

# MCUboot bootloader integration
CONFIG_BOOTLOADER_MCUBOOT=y

# External QSPI NOR flash (MX25R1635F, 2 MiB)
CONFIG_FLASH=y
CONFIG_NORDIC_QSPI_NOR=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_NORDIC_QSPI_NOR_FLASH_LAYOUT_PAGE_SIZE=4096

# USB device stack (new stack - Zephyr 3.7+/NCS 4.x)
# Falls back to legacy stack for older Zephyr versions via board.c #ifdef
CONFIG_USB_DEVICE_STACK_NEXT=y

# CDC ACM class for new USB stack
CONFIG_USBD_CDC_ACM_CLASS=y

# Serial driver (required by MCUMGR_TRANSPORT_UART)
CONFIG_SERIAL=y

# UART line control (required for CDC ACM virtual UART)
CONFIG_UART_LINE_CTRL=y

# USB is initialized manually in board_init() to allow registering a status
# callback for RTT logging of connect/disconnect events.
CONFIG_USB_DEVICE_INITIALIZE_AT_BOOT=n

# mcumgr core + UART transport (CDC ACM reuses the UART transport)
CONFIG_MCUMGR=y
CONFIG_MCUMGR_TRANSPORT_UART=y

# mcumgr transport dependencies
CONFIG_NET_BUF=y
CONFIG_ZCBOR=y
CONFIG_BASE64=y
CONFIG_CRC=y

# Flash infrastructure for image upload
CONFIG_FLASH_MAP=y
CONFIG_STREAM_FLASH=y

# Image manager (MCUboot slot read/write/verify)
CONFIG_IMG_MANAGER=y

# Image management group: upload, list, test, confirm
CONFIG_MCUMGR_GRP_IMG=y

# OS management group: remote reset (triggers MCUboot swap)
CONFIG_MCUMGR_GRP_OS=y
CONFIG_REBOOT=y
